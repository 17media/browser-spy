{"version":3,"file":"index.esm.js","sources":["../src/utils/loadScript.ts","../src/utils/object.ts","../src/Agent.ts","../src/utils/dom.ts","../node_modules/uuid/dist/esm-node/rng.js","../node_modules/uuid/dist/esm-node/bytesToUuid.js","../node_modules/uuid/dist/esm-node/v4.js","../src/utils/param.ts","../src/Source.ts","../src/types.ts","../src/utils/constants.ts","../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/intersection-observer/intersection-observer.js","../src/Observer.ts","../src/hooks.ts","../src/actions.ts"],"sourcesContent":["export function loadScript(src: string) {\n  const script = document.createElement('script');\n  script.type = 'text/javascript';\n  script.defer = true;\n  script.src = src;\n\n  const firstScript = document.getElementsByTagName('script')[0];\n  firstScript.parentNode!.insertBefore(script, firstScript);\n\n  return new Promise((resolve, reject) => {\n    script.onload = resolve;\n    script.onerror = reject;\n  });\n}\n\nexport function loadScripts(...src: string[]) {\n  return Promise.all(src.map(loadScript));\n}\n","export function trim(object: Record<string, any>) {\n  for (const key in object) {\n    if (typeof object[key] === 'undefined') {\n      delete object[key];\n    }\n    if (object[key] === null) {\n      delete object[key];\n    }\n  }\n}\n\nexport function convertStringToSankecase(str: string) {\n  const upperCaseMap = new Map();\n  const strArray = Array.from(str);\n  strArray.forEach((char, index) => {\n    const currentCharCode = char.charCodeAt(0);\n    const asciiCodeA = 'A'.charCodeAt(0);\n    const asciiCodeZ = 'Z'.charCodeAt(0);\n    if (currentCharCode >= asciiCodeA && currentCharCode <= asciiCodeZ) {\n      upperCaseMap.set(index, char);\n    }\n  });\n  upperCaseMap.forEach((value, key) => {\n    strArray[key] = `_${value.toLowerCase()}`;\n  });\n  return strArray.join('');\n}\n\nexport function convertParamsToSankecase<T>(params: T) {\n  return Object.keys(params).reduce((prev: Record<string, any>, key: string) => {\n    const currentParams = prev;\n    const snakecaseKey = convertStringToSankecase(key);\n    currentParams[snakecaseKey] = (params as any)[key];\n    return currentParams;\n  }, {});\n}\n","/* eslint-disable @typescript-eslint/camelcase */\n\nimport { loadScript, loadScripts } from 'utils/loadScript';\nimport * as object from 'utils/object';\nimport { TrackingEvent, TransitionEvent, LoginEvent, SpyEvent } from 'types';\nimport type { analytics } from 'firebase';\n\nenum AgentState {\n  Uninitialized,\n  Initializing,\n  Initialized,\n  InitializeFail,\n}\n\ndeclare var firebase: any;\n\nexport abstract class Agent {\n  protected state = AgentState.Uninitialized;\n\n  async initialize() {\n    if (this.state !== AgentState.Uninitialized) return;\n\n    this.state = AgentState.Initializing;\n\n    try {\n      await this.doInitialize();\n      this.state = AgentState.Initialized;\n    } catch (error) {\n      console.error(error);\n      this.state = AgentState.InitializeFail;\n    }\n  }\n\n  abstract report(event: SpyEvent): void;\n\n  protected abstract doInitialize(): Promise<void> | void;\n}\n\nlet isInit = false;\n\nexport class FirebaseAgent extends Agent {\n  private client!: analytics.Analytics;\n\n  private queue: Array<() => void> = [];\n\n  /**\n   * @param config @see https://support.google.com/firebase/answer/7015592\n   */\n  constructor(readonly config: any) {\n    super();\n  }\n\n  async doInitialize() {\n    await loadScripts(\n      'https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js',\n      'https://www.gstatic.com/firebasejs/7.14.1/firebase-analytics.js',\n    );\n\n    if (!isInit) {\n      this.client = firebase.initializeApp(this.config).analytics();\n      isInit = true;\n    } else {\n      this.client = firebase.analytics();\n    }\n\n    this.queue.forEach(callback => callback());\n\n    this.queue = [];\n  }\n\n  report(event: SpyEvent) {\n    this.queueIfNotInitialized(() => this.doReport(event));\n  }\n\n  private doReport(event: SpyEvent) {\n    switch (event.type) {\n      case 'login':\n        return this.login(event);\n      case 'tracking':\n        return this.track(event);\n      case 'transition':\n        return this.transit(event);\n      default:\n        break;\n    }\n  }\n\n  private login(event: LoginEvent) {\n    const { userId } = event;\n    this.client.setUserId(userId, { global: true });\n    if (userId) this.client.logEvent('login', { userId });\n  }\n\n  private transit(event: TransitionEvent) {\n    const { toScene, defaultTrackingParams } = event;\n    const { title, hostname, pathname } = toScene;\n    this.client.logEvent('page_view', {\n      page_title: title,\n      page_location: hostname,\n      page_path: pathname,\n      ...object.convertParamsToSankecase(defaultTrackingParams),\n    });\n    this.client.setCurrentScreen(event.toScene.title, { global: true });\n  }\n\n  private track(event: TrackingEvent) {\n    const { eventName, trackingParams = {} } = event;\n    object.trim(trackingParams);\n    this.client.logEvent(eventName, object.convertParamsToSankecase(trackingParams));\n  }\n\n  private queueIfNotInitialized(callback: () => void) {\n    if (this.state === AgentState.Initialized) callback();\n    else this.queue.push(callback);\n  }\n}\n\nexport interface MatomoAgentConfig {\n  endpoint: string;\n  siteId: string;\n}\n\nexport class MatomoAgent extends Agent {\n  private client = window._paq; // eslint-disable-line no-underscore-dangle\n\n  private trackPageViewTimer = 0;\n\n  private intialized = false;\n\n  constructor(readonly config: MatomoAgentConfig) {\n    super();\n  }\n\n  async doInitialize() {\n    const url = `//${this.config.endpoint}/`;\n    this.client.push(['setTrackerUrl', `${url}matomo.php`]);\n    this.client.push(['setSiteId', this.config.siteId]);\n    this.client.push(['trackPageView']);\n    this.client.push(['enableLinkTracking']);\n    this.client.push(['trackAllContentImpressions']);\n\n    await loadScript(`${url}piwik.js`);\n  }\n\n  report(event: SpyEvent) {\n    switch (event.type) {\n      case 'login':\n        return this.login(event);\n      case 'tracking':\n        return this.track(event);\n      case 'transition':\n        return this.transit(event);\n      default:\n        break;\n    }\n  }\n\n  private login(event: LoginEvent) {\n    const { userId } = event;\n    if (userId) this.client.push(['setUserId', userId]);\n    else this.client.push(['resetUserId']);\n    this.requestTrackPageView();\n  }\n\n  private transit(event: TransitionEvent) {\n    const { fromScene, toScene } = event;\n    this.client.push(['setReferrerUrl', `${fromScene.hostname}${fromScene.pathname}`]);\n    this.client.push(['setCustomUrl', `${toScene.hostname}${fromScene.pathname}`]);\n    this.client.push(['setDocumentTitle', toScene.title]);\n    this.client.push(['setGenerationTimeMs', 0]);\n    this.requestTrackPageView();\n    this.client.push(['enableLinkTracking']);\n    this.client.push(['trackAllContentImpressions']);\n  }\n\n  private track(event: TrackingEvent) {\n    /**\n     * ref : https://developer.matomo.org/guides/tracking-javascript\n     * trackEvent(category, action, [name], [value]) -\n     * Log an event with an event category (Videos, Music, Games...), an event action (Play, Pause, Duration, Add Playlist, Downloaded, Clicked...), and an optional event name and optional numeric value.\n     */\n    const { eventName, category, trackingParams = {} } = event;\n    const { name = '', value = '' } = trackingParams;\n    this.client.push(['trackEvent', category, eventName, name, value]);\n  }\n\n  private requestTrackPageView() {\n    if (this.trackPageViewTimer) clearTimeout(this.trackPageViewTimer);\n    this.trackPageViewTimer = setTimeout(() => {\n      this.client.push(['trackPageView']);\n      this.trackPageViewTimer = 0;\n    });\n  }\n}\n","const tagNameRole: Record<string, string | undefined> = {\n  alert: 'alert',\n  alertdialog: 'alertdialog',\n  application: 'application',\n  article: 'article',\n  banner: 'banner',\n  button: 'button',\n  cell: 'cell',\n  checkbox: 'checkbox',\n  columnheader: 'columnheader',\n  combobox: 'combobox',\n  command: 'command',\n  complementary: 'complementary',\n  composite: 'composite',\n  contentinfo: 'contentinfo',\n  definition: 'definition',\n  dialog: 'dialog',\n  directory: 'directory',\n  document: 'document',\n  feed: 'feed',\n  figure: 'figure',\n  form: 'form',\n  grid: 'grid',\n  gridcell: 'gridcell',\n  group: 'group',\n  heading: 'heading',\n  img: 'img',\n  input: 'input',\n  landmark: 'landmark',\n  link: 'link',\n  list: 'list',\n  listbox: 'listbox',\n  listitem: 'listitem',\n  log: 'log',\n  main: 'main',\n  'The main content of a document.': 'The main content of a document.',\n  marquee: 'marquee',\n  math: 'math',\n  'Content that represents a mathematical expression.': 'Content that represents a mathematical expression.',\n  menu: 'menu',\n  menubar: 'menubar',\n  menuitem: 'menuitem',\n  menuitemcheckbox: 'menuitemcheckbox',\n  menuitemradio: 'menuitemradio',\n  navigation: 'navigation',\n  none: 'none',\n  note: 'note',\n  option: 'option',\n  presentation: 'presentation',\n  progressbar: 'progressbar',\n  radio: 'radio',\n  radiogroup: 'radiogroup',\n  range: 'range',\n  region: 'region',\n  roletype: 'roletype',\n  row: 'row',\n  rowgroup: 'rowgroup',\n  rowheader: 'rowheader',\n  scrollbar: 'scrollbar',\n  search: 'search',\n  searchbox: 'searchbox',\n  section: 'section',\n  sectionhead: 'sectionhead',\n  select: 'select',\n  separator: 'separator',\n  slider: 'slider',\n  spinbutton: 'spinbutton',\n  status: 'status',\n  structure: 'structure',\n  switch: 'switch',\n  tab: 'tab',\n  table: 'table',\n  tablist: 'tablist',\n  tabpanel: 'tabpanel',\n  term: 'term',\n  textbox: 'textbox',\n  timer: 'timer',\n  toolbar: 'toolbar',\n  tooltip: 'tooltip',\n  tree: 'tree',\n  treegrid: 'treegrid',\n  treeitem: 'treeitem',\n  widget: 'widget',\n  window: 'window',\n};\n\nexport function guessRole(element: HTMLElement) {\n  return element.getAttribute('role') || tagNameRole[element.tagName] || 'unknown';\n}\n\nexport function getContent(element: HTMLElement) {\n  return element.innerText;\n}\n","import crypto from 'crypto';\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  return crypto.randomFillSync(rnds8);\n}","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction bytesToUuid(buf, offset_) {\n  const offset = offset_ || 0; // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n\n  return (byteToHex[buf[offset + 0]] + byteToHex[buf[offset + 1]] + byteToHex[buf[offset + 2]] + byteToHex[buf[offset + 3]] + '-' + byteToHex[buf[offset + 4]] + byteToHex[buf[offset + 5]] + '-' + byteToHex[buf[offset + 6]] + byteToHex[buf[offset + 7]] + '-' + byteToHex[buf[offset + 8]] + byteToHex[buf[offset + 9]] + '-' + byteToHex[buf[offset + 10]] + byteToHex[buf[offset + 11]] + byteToHex[buf[offset + 12]] + byteToHex[buf[offset + 13]] + byteToHex[buf[offset + 14]] + byteToHex[buf[offset + 15]]).toLowerCase();\n}\n\nexport default bytesToUuid;","import rng from './rng.js';\nimport bytesToUuid from './bytesToUuid.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return bytesToUuid(rnds);\n}\n\nexport default v4;","import qs from 'query-string';\nimport { v4 } from 'uuid';\nimport { Scene, DefaultEventParams, RefinedEventPathname, TrackingToken } from 'types';\n\nfunction getUserID() {\n  const qsUserID = qs.parse(window.location.search).userID;\n  if (Array.isArray(qsUserID)) {\n    return sessionStorage.getItem('userID') || 'guest';\n  }\n  // The order of checking UserID.\n  // 1. sessionStorage\n  // 2. query string\n  return sessionStorage.getItem('userID') || qsUserID || 'guest';\n}\n\nfunction createTrackingToken() {\n  const storageKey = 'trackingToken';\n  const days30 = 60 * 60 * 24 * 30 * 1000;\n  const newTrackingToken: TrackingToken = {\n    sessionID: v4(),\n    date: Date.now(),\n  };\n\n  try {\n    const trackingToken = JSON.parse(localStorage.getItem(storageKey) || '') as TrackingToken;\n    const { date, sessionID } = trackingToken;\n    // Expired checking (after 30 days)\n    if (Date.now() - date < days30) return sessionID;\n\n    localStorage.setItem(storageKey, JSON.stringify(newTrackingToken));\n  } catch (error) {\n    localStorage.setItem(storageKey, JSON.stringify(newTrackingToken));\n  }\n  return newTrackingToken.sessionID;\n}\n\nexport function createScene(): Scene {\n  const { title } = window.document;\n  const { hostname, pathname } = window.location;\n  return { title, hostname, pathname };\n}\n\nexport function refineEventPathname(pathname: string): RefinedEventPathname {\n  const slashCount = pathname.match(/-/g)?.length;\n  if (slashCount && slashCount >= 3) {\n    // slashCount === 3+\n    const pathnameArray = pathname.split('-');\n    const eventId = pathnameArray[0];\n    const codename = pathnameArray.splice(1, pathnameArray.length).join('-');\n    return { eventId, codename };\n  }\n  return { eventId: '', codename: pathname };\n}\n\nexport function createDefaultEventParams(): DefaultEventParams {\n  const codenameArray = window.location.pathname.split('/');\n  const eventPathname = codenameArray.length > 1 ? codenameArray[1] : '';\n  const { eventId, codename } = refineEventPathname(eventPathname);\n  const trackingToken = createTrackingToken();\n\n  return {\n    userId: getUserID(),\n    lang: navigator.language || '',\n    os: navigator.userAgent || '',\n    timestamp: Date.now(),\n    codename,\n    eventId,\n    guestSessionId: trackingToken,\n  };\n}\n","import { TransitionEvent, TrackingEvent, TrackingEventParams, Scene } from 'types';\nimport { Agent } from 'Agent';\nimport { History } from 'history';\nimport * as dom from 'utils/dom';\nimport { createScene, createDefaultEventParams } from 'utils/param';\n\nexport interface Source {\n  addAgent(agent: Agent): void;\n}\n\nexport class DefaultSource implements Source {\n  private agents: Agent[] = [];\n\n  private currentScene: Scene = createScene();\n\n  addAgent(agent: Agent) {\n    agent.initialize();\n    this.agents.push(agent);\n  }\n\n  spyTransition(history: History) {\n    // wait for whole page updated\n    // init page_view\n    setTimeout(() => this.transit(createScene()), 100);\n    history.listen(() => {\n      const { action } = history;\n      // Filtering replace action (The pushed url is not matching, ex: Redirect)\n      if (action === 'PUSH') {\n        setTimeout(() => this.transit(createScene()), 100);\n      }\n    });\n  }\n\n  spyClick() {\n    window.addEventListener('click', event => {\n      const { target } = event;\n      if (target instanceof HTMLElement) {\n        this.track({\n          eventName: 'click',\n          category: 'default',\n          trackingParams: {\n            name: dom.getContent(target),\n            value: '',\n            role: dom.guessRole(target),\n          },\n        });\n      }\n    });\n  }\n\n  // tracking page visibility. e.g. page minimized, change browser tab or page unload\n  spyPageDurationByVisible(params?: TrackingEventParams) {\n    let startDurationTime: number = 0;\n\n    const handleVisibleChange = (e: Event) => {\n      if (document.visibilityState === 'hidden') {\n        const endDurationTime = e.timeStamp;\n        const duration = Math.floor(endDurationTime - startDurationTime);\n        this.track({\n          eventName: 'pageView',\n          category: 'default',\n          trackingParams: {\n            url: window.location.href,\n            duration,\n            ...params,\n          },\n        });\n      }\n      if (document.visibilityState === 'visible') {\n        startDurationTime = e.timeStamp;\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibleChange);\n  }\n\n  spyPageDurationByTransition(history: History, params?: TrackingEventParams) {\n    let startDurationTime: number = Date.now();\n    let url = window.location.href;\n    history.listen(() => {\n      const endDurationTime: number = Date.now();\n      const duration = Math.floor(endDurationTime - startDurationTime);\n      this.track({\n        eventName: 'pageView',\n        category: 'default',\n        trackingParams: {\n          url,\n          duration,\n          ...params,\n        },\n      });\n      startDurationTime = endDurationTime;\n      url = window.location.href;\n    });\n  }\n\n  login(userId: string) {\n    this.agents.forEach(agent => agent.report({ type: 'login', userId }));\n  }\n\n  transit(toScene: Scene) {\n    const fromScene = this.currentScene;\n    const event: TransitionEvent = {\n      type: 'transition',\n      fromScene,\n      toScene,\n      defaultTrackingParams: createDefaultEventParams(),\n    };\n    this.agents.forEach(agent => agent.report(event));\n  }\n\n  track(event: Omit<TrackingEvent, 'type'>) {\n    const { trackingParams } = event;\n    const defaultParams = trackingParams?.hasOwnProperty('productName') ? {} : createDefaultEventParams();\n    const mergedTrackingParams = {\n      ...defaultParams,\n      ...trackingParams,\n    };\n    event.trackingParams = mergedTrackingParams;\n    this.agents.forEach(agent => agent.report({ type: 'tracking', ...event }));\n  }\n}\n","export enum Threshold {\n  'MIN' = 0,\n  'HALF' = 0.5,\n  'FULL' = 1,\n}\n\nexport interface Scene {\n  title: string;\n  hostname: string;\n  pathname: string;\n}\n\nexport interface TransitionEvent {\n  type: 'transition';\n  fromScene: Scene;\n  toScene: Scene;\n  defaultTrackingParams: DefaultEventParams;\n}\n\nexport interface TrackingToken {\n  sessionID: string;\n  date: number;\n}\n\nexport interface TrackingEventParams {\n  userId?: string;\n  lang?: string;\n  os?: string;\n  eventId?: string;\n  timestamp?: number;\n  action?: string;\n  name?: string;\n  role?: string;\n  value?: string;\n  page?: string;\n  type?: string;\n  leaderboardId?: string;\n  streamerId?: string;\n  liveStatus?: boolean;\n  section?: string;\n  rank?: number;\n  to?: string;\n  url?: string;\n  utmCampaign?: string;\n  utmContent?: string;\n  utmMedium?: string;\n  utmSource?: string;\n  searchString?: string;\n  resultCount?: number;\n  hasDeeplink?: boolean;\n  codename?: string;\n  productName?: string;\n  userName?: string;\n  from?: string;\n  result?: string;\n  duration?: number;\n  customPath?: string;\n}\nexport interface TrackingEvent {\n  type: 'tracking';\n  eventName: string;\n  category: string;\n  trackingParams?: TrackingEventParams;\n}\n\nexport interface DefaultEventParams {\n  userId: string;\n  lang: string;\n  os: string;\n  eventId: string;\n  timestamp: number;\n  codename: string;\n  guestSessionId: string;\n}\n\nexport interface LoginEvent {\n  type: 'login';\n  userId: string;\n}\n\nexport interface RefinedEventPathname {\n  eventId: string;\n  codename: string;\n}\n\nexport type ElementMap = Map<Element, Function>;\n\nexport type SpyEvent = TrackingEvent | TransitionEvent | LoginEvent;\n\nexport type EventCallback<T> = (event: T) => void;\n\nexport type EventListener<T> = (callback: EventCallback<T>) => void;\n","export const EVENT_NAME_CLICK = 'click';\nexport const EVENT_NAME_ENTER = 'enter';\nexport const EVENT_NAME_LEAVE = 'leave';\nexport const EVENT_NAME_SEARCH = 'search';\nexport const EVENT_NAME_SECTION_VIEW = 'section_view';\n\nexport const CATEGORY_DEFAULT = 'default';\n\nexport const ACTION_BUTTON_CLICK = 'ButtonClick';\nexport const ACTION_TAB_CLICK = 'TabClick';\nexport const ACTION_PROFILE_CLICK = 'ProfileClick';\nexport const ACTION_LINK_CLICK = 'LinkClick';\nexport const ACTION_ENTER = 'enter';\n\nexport const __CLIENT__ = typeof window !== 'undefined' && typeof window.document !== 'undefined';\n","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the W3C SOFTWARE AND DOCUMENT NOTICE AND LICENSE.\n *\n *  https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document\n *\n */\n(function() {\n'use strict';\n\n// Exit early if we're not running in a browser.\nif (typeof window !== 'object') {\n  return;\n}\n\n// Exit early if all IntersectionObserver and IntersectionObserverEntry\n// features are natively supported.\nif ('IntersectionObserver' in window &&\n    'IntersectionObserverEntry' in window &&\n    'intersectionRatio' in window.IntersectionObserverEntry.prototype) {\n\n  // Minimal polyfill for Edge 15's lack of `isIntersecting`\n  // See: https://github.com/w3c/IntersectionObserver/issues/211\n  if (!('isIntersecting' in window.IntersectionObserverEntry.prototype)) {\n    Object.defineProperty(window.IntersectionObserverEntry.prototype,\n      'isIntersecting', {\n      get: function () {\n        return this.intersectionRatio > 0;\n      }\n    });\n  }\n  return;\n}\n\n\n/**\n * A local reference to the document.\n */\nvar document = window.document;\n\n\n/**\n * An IntersectionObserver registry. This registry exists to hold a strong\n * reference to IntersectionObserver instances currently observing a target\n * element. Without this registry, instances without another reference may be\n * garbage collected.\n */\nvar registry = [];\n\n/**\n * The signal updater for cross-origin intersection. When not null, it means\n * that the polyfill is configured to work in a cross-origin mode.\n * @type {function(DOMRect|ClientRect, DOMRect|ClientRect)}\n */\nvar crossOriginUpdater = null;\n\n/**\n * The current cross-origin intersection. Only used in the cross-origin mode.\n * @type {DOMRect|ClientRect}\n */\nvar crossOriginRect = null;\n\n\n/**\n * Creates the global IntersectionObserverEntry constructor.\n * https://w3c.github.io/IntersectionObserver/#intersection-observer-entry\n * @param {Object} entry A dictionary of instance properties.\n * @constructor\n */\nfunction IntersectionObserverEntry(entry) {\n  this.time = entry.time;\n  this.target = entry.target;\n  this.rootBounds = ensureDOMRect(entry.rootBounds);\n  this.boundingClientRect = ensureDOMRect(entry.boundingClientRect);\n  this.intersectionRect = ensureDOMRect(entry.intersectionRect || getEmptyRect());\n  this.isIntersecting = !!entry.intersectionRect;\n\n  // Calculates the intersection ratio.\n  var targetRect = this.boundingClientRect;\n  var targetArea = targetRect.width * targetRect.height;\n  var intersectionRect = this.intersectionRect;\n  var intersectionArea = intersectionRect.width * intersectionRect.height;\n\n  // Sets intersection ratio.\n  if (targetArea) {\n    // Round the intersection ratio to avoid floating point math issues:\n    // https://github.com/w3c/IntersectionObserver/issues/324\n    this.intersectionRatio = Number((intersectionArea / targetArea).toFixed(4));\n  } else {\n    // If area is zero and is intersecting, sets to 1, otherwise to 0\n    this.intersectionRatio = this.isIntersecting ? 1 : 0;\n  }\n}\n\n\n/**\n * Creates the global IntersectionObserver constructor.\n * https://w3c.github.io/IntersectionObserver/#intersection-observer-interface\n * @param {Function} callback The function to be invoked after intersection\n *     changes have queued. The function is not invoked if the queue has\n *     been emptied by calling the `takeRecords` method.\n * @param {Object=} opt_options Optional configuration options.\n * @constructor\n */\nfunction IntersectionObserver(callback, opt_options) {\n\n  var options = opt_options || {};\n\n  if (typeof callback != 'function') {\n    throw new Error('callback must be a function');\n  }\n\n  if (options.root && options.root.nodeType != 1) {\n    throw new Error('root must be an Element');\n  }\n\n  // Binds and throttles `this._checkForIntersections`.\n  this._checkForIntersections = throttle(\n      this._checkForIntersections.bind(this), this.THROTTLE_TIMEOUT);\n\n  // Private properties.\n  this._callback = callback;\n  this._observationTargets = [];\n  this._queuedEntries = [];\n  this._rootMarginValues = this._parseRootMargin(options.rootMargin);\n\n  // Public properties.\n  this.thresholds = this._initThresholds(options.threshold);\n  this.root = options.root || null;\n  this.rootMargin = this._rootMarginValues.map(function(margin) {\n    return margin.value + margin.unit;\n  }).join(' ');\n\n  /** @private @const {!Array<!Document>} */\n  this._monitoringDocuments = [];\n  /** @private @const {!Array<function()>} */\n  this._monitoringUnsubscribes = [];\n}\n\n\n/**\n * The minimum interval within which the document will be checked for\n * intersection changes.\n */\nIntersectionObserver.prototype.THROTTLE_TIMEOUT = 100;\n\n\n/**\n * The frequency in which the polyfill polls for intersection changes.\n * this can be updated on a per instance basis and must be set prior to\n * calling `observe` on the first target.\n */\nIntersectionObserver.prototype.POLL_INTERVAL = null;\n\n/**\n * Use a mutation observer on the root element\n * to detect intersection changes.\n */\nIntersectionObserver.prototype.USE_MUTATION_OBSERVER = true;\n\n\n/**\n * Sets up the polyfill in the cross-origin mode. The result is the\n * updater function that accepts two arguments: `boundingClientRect` and\n * `intersectionRect` - just as these fields would be available to the\n * parent via `IntersectionObserverEntry`. This function should be called\n * each time the iframe receives intersection information from the parent\n * window, e.g. via messaging.\n * @return {function(DOMRect|ClientRect, DOMRect|ClientRect)}\n */\nIntersectionObserver._setupCrossOriginUpdater = function() {\n  if (!crossOriginUpdater) {\n    /**\n     * @param {DOMRect|ClientRect} boundingClientRect\n     * @param {DOMRect|ClientRect} intersectionRect\n     */\n    crossOriginUpdater = function(boundingClientRect, intersectionRect) {\n      if (!boundingClientRect || !intersectionRect) {\n        crossOriginRect = getEmptyRect();\n      } else {\n        crossOriginRect = convertFromParentRect(boundingClientRect, intersectionRect);\n      }\n      registry.forEach(function(observer) {\n        observer._checkForIntersections();\n      });\n    };\n  }\n  return crossOriginUpdater;\n};\n\n\n/**\n * Resets the cross-origin mode.\n */\nIntersectionObserver._resetCrossOriginUpdater = function() {\n  crossOriginUpdater = null;\n  crossOriginRect = null;\n};\n\n\n/**\n * Starts observing a target element for intersection changes based on\n * the thresholds values.\n * @param {Element} target The DOM element to observe.\n */\nIntersectionObserver.prototype.observe = function(target) {\n  var isTargetAlreadyObserved = this._observationTargets.some(function(item) {\n    return item.element == target;\n  });\n\n  if (isTargetAlreadyObserved) {\n    return;\n  }\n\n  if (!(target && target.nodeType == 1)) {\n    throw new Error('target must be an Element');\n  }\n\n  this._registerInstance();\n  this._observationTargets.push({element: target, entry: null});\n  this._monitorIntersections(target.ownerDocument);\n  this._checkForIntersections();\n};\n\n\n/**\n * Stops observing a target element for intersection changes.\n * @param {Element} target The DOM element to observe.\n */\nIntersectionObserver.prototype.unobserve = function(target) {\n  this._observationTargets =\n      this._observationTargets.filter(function(item) {\n        return item.element != target;\n      });\n  this._unmonitorIntersections(target.ownerDocument);\n  if (this._observationTargets.length == 0) {\n    this._unregisterInstance();\n  }\n};\n\n\n/**\n * Stops observing all target elements for intersection changes.\n */\nIntersectionObserver.prototype.disconnect = function() {\n  this._observationTargets = [];\n  this._unmonitorAllIntersections();\n  this._unregisterInstance();\n};\n\n\n/**\n * Returns any queue entries that have not yet been reported to the\n * callback and clears the queue. This can be used in conjunction with the\n * callback to obtain the absolute most up-to-date intersection information.\n * @return {Array} The currently queued entries.\n */\nIntersectionObserver.prototype.takeRecords = function() {\n  var records = this._queuedEntries.slice();\n  this._queuedEntries = [];\n  return records;\n};\n\n\n/**\n * Accepts the threshold value from the user configuration object and\n * returns a sorted array of unique threshold values. If a value is not\n * between 0 and 1 and error is thrown.\n * @private\n * @param {Array|number=} opt_threshold An optional threshold value or\n *     a list of threshold values, defaulting to [0].\n * @return {Array} A sorted list of unique and valid threshold values.\n */\nIntersectionObserver.prototype._initThresholds = function(opt_threshold) {\n  var threshold = opt_threshold || [0];\n  if (!Array.isArray(threshold)) threshold = [threshold];\n\n  return threshold.sort().filter(function(t, i, a) {\n    if (typeof t != 'number' || isNaN(t) || t < 0 || t > 1) {\n      throw new Error('threshold must be a number between 0 and 1 inclusively');\n    }\n    return t !== a[i - 1];\n  });\n};\n\n\n/**\n * Accepts the rootMargin value from the user configuration object\n * and returns an array of the four margin values as an object containing\n * the value and unit properties. If any of the values are not properly\n * formatted or use a unit other than px or %, and error is thrown.\n * @private\n * @param {string=} opt_rootMargin An optional rootMargin value,\n *     defaulting to '0px'.\n * @return {Array<Object>} An array of margin objects with the keys\n *     value and unit.\n */\nIntersectionObserver.prototype._parseRootMargin = function(opt_rootMargin) {\n  var marginString = opt_rootMargin || '0px';\n  var margins = marginString.split(/\\s+/).map(function(margin) {\n    var parts = /^(-?\\d*\\.?\\d+)(px|%)$/.exec(margin);\n    if (!parts) {\n      throw new Error('rootMargin must be specified in pixels or percent');\n    }\n    return {value: parseFloat(parts[1]), unit: parts[2]};\n  });\n\n  // Handles shorthand.\n  margins[1] = margins[1] || margins[0];\n  margins[2] = margins[2] || margins[0];\n  margins[3] = margins[3] || margins[1];\n\n  return margins;\n};\n\n\n/**\n * Starts polling for intersection changes if the polling is not already\n * happening, and if the page's visibility state is visible.\n * @param {!Document} doc\n * @private\n */\nIntersectionObserver.prototype._monitorIntersections = function(doc) {\n  var win = doc.defaultView;\n  if (!win) {\n    // Already destroyed.\n    return;\n  }\n  if (this._monitoringDocuments.indexOf(doc) != -1) {\n    // Already monitoring.\n    return;\n  }\n\n  // Private state for monitoring.\n  var callback = this._checkForIntersections;\n  var monitoringInterval = null;\n  var domObserver = null;\n\n  // If a poll interval is set, use polling instead of listening to\n  // resize and scroll events or DOM mutations.\n  if (this.POLL_INTERVAL) {\n    monitoringInterval = win.setInterval(callback, this.POLL_INTERVAL);\n  } else {\n    addEvent(win, 'resize', callback, true);\n    addEvent(doc, 'scroll', callback, true);\n    if (this.USE_MUTATION_OBSERVER && 'MutationObserver' in win) {\n      domObserver = new win.MutationObserver(callback);\n      domObserver.observe(doc, {\n        attributes: true,\n        childList: true,\n        characterData: true,\n        subtree: true\n      });\n    }\n  }\n\n  this._monitoringDocuments.push(doc);\n  this._monitoringUnsubscribes.push(function() {\n    // Get the window object again. When a friendly iframe is destroyed, it\n    // will be null.\n    var win = doc.defaultView;\n\n    if (win) {\n      if (monitoringInterval) {\n        win.clearInterval(monitoringInterval);\n      }\n      removeEvent(win, 'resize', callback, true);\n    }\n\n    removeEvent(doc, 'scroll', callback, true);\n    if (domObserver) {\n      domObserver.disconnect();\n    }\n  });\n\n  // Also monitor the parent.\n  if (doc != (this.root && this.root.ownerDocument || document)) {\n    var frame = getFrameElement(doc);\n    if (frame) {\n      this._monitorIntersections(frame.ownerDocument);\n    }\n  }\n};\n\n\n/**\n * Stops polling for intersection changes.\n * @param {!Document} doc\n * @private\n */\nIntersectionObserver.prototype._unmonitorIntersections = function(doc) {\n  var index = this._monitoringDocuments.indexOf(doc);\n  if (index == -1) {\n    return;\n  }\n\n  var rootDoc = (this.root && this.root.ownerDocument || document);\n\n  // Check if any dependent targets are still remaining.\n  var hasDependentTargets =\n      this._observationTargets.some(function(item) {\n        var itemDoc = item.element.ownerDocument;\n        // Target is in this context.\n        if (itemDoc == doc) {\n          return true;\n        }\n        // Target is nested in this context.\n        while (itemDoc && itemDoc != rootDoc) {\n          var frame = getFrameElement(itemDoc);\n          itemDoc = frame && frame.ownerDocument;\n          if (itemDoc == doc) {\n            return true;\n          }\n        }\n        return false;\n      });\n  if (hasDependentTargets) {\n    return;\n  }\n\n  // Unsubscribe.\n  var unsubscribe = this._monitoringUnsubscribes[index];\n  this._monitoringDocuments.splice(index, 1);\n  this._monitoringUnsubscribes.splice(index, 1);\n  unsubscribe();\n\n  // Also unmonitor the parent.\n  if (doc != rootDoc) {\n    var frame = getFrameElement(doc);\n    if (frame) {\n      this._unmonitorIntersections(frame.ownerDocument);\n    }\n  }\n};\n\n\n/**\n * Stops polling for intersection changes.\n * @param {!Document} doc\n * @private\n */\nIntersectionObserver.prototype._unmonitorAllIntersections = function() {\n  var unsubscribes = this._monitoringUnsubscribes.slice(0);\n  this._monitoringDocuments.length = 0;\n  this._monitoringUnsubscribes.length = 0;\n  for (var i = 0; i < unsubscribes.length; i++) {\n    unsubscribes[i]();\n  }\n};\n\n\n/**\n * Scans each observation target for intersection changes and adds them\n * to the internal entries queue. If new entries are found, it\n * schedules the callback to be invoked.\n * @private\n */\nIntersectionObserver.prototype._checkForIntersections = function() {\n  if (!this.root && crossOriginUpdater && !crossOriginRect) {\n    // Cross origin monitoring, but no initial data available yet.\n    return;\n  }\n\n  var rootIsInDom = this._rootIsInDom();\n  var rootRect = rootIsInDom ? this._getRootRect() : getEmptyRect();\n\n  this._observationTargets.forEach(function(item) {\n    var target = item.element;\n    var targetRect = getBoundingClientRect(target);\n    var rootContainsTarget = this._rootContainsTarget(target);\n    var oldEntry = item.entry;\n    var intersectionRect = rootIsInDom && rootContainsTarget &&\n        this._computeTargetAndRootIntersection(target, targetRect, rootRect);\n\n    var newEntry = item.entry = new IntersectionObserverEntry({\n      time: now(),\n      target: target,\n      boundingClientRect: targetRect,\n      rootBounds: crossOriginUpdater && !this.root ? null : rootRect,\n      intersectionRect: intersectionRect\n    });\n\n    if (!oldEntry) {\n      this._queuedEntries.push(newEntry);\n    } else if (rootIsInDom && rootContainsTarget) {\n      // If the new entry intersection ratio has crossed any of the\n      // thresholds, add a new entry.\n      if (this._hasCrossedThreshold(oldEntry, newEntry)) {\n        this._queuedEntries.push(newEntry);\n      }\n    } else {\n      // If the root is not in the DOM or target is not contained within\n      // root but the previous entry for this target had an intersection,\n      // add a new record indicating removal.\n      if (oldEntry && oldEntry.isIntersecting) {\n        this._queuedEntries.push(newEntry);\n      }\n    }\n  }, this);\n\n  if (this._queuedEntries.length) {\n    this._callback(this.takeRecords(), this);\n  }\n};\n\n\n/**\n * Accepts a target and root rect computes the intersection between then\n * following the algorithm in the spec.\n * TODO(philipwalton): at this time clip-path is not considered.\n * https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo\n * @param {Element} target The target DOM element\n * @param {Object} targetRect The bounding rect of the target.\n * @param {Object} rootRect The bounding rect of the root after being\n *     expanded by the rootMargin value.\n * @return {?Object} The final intersection rect object or undefined if no\n *     intersection is found.\n * @private\n */\nIntersectionObserver.prototype._computeTargetAndRootIntersection =\n    function(target, targetRect, rootRect) {\n  // If the element isn't displayed, an intersection can't happen.\n  if (window.getComputedStyle(target).display == 'none') return;\n\n  var intersectionRect = targetRect;\n  var parent = getParentNode(target);\n  var atRoot = false;\n\n  while (!atRoot && parent) {\n    var parentRect = null;\n    var parentComputedStyle = parent.nodeType == 1 ?\n        window.getComputedStyle(parent) : {};\n\n    // If the parent isn't displayed, an intersection can't happen.\n    if (parentComputedStyle.display == 'none') return null;\n\n    if (parent == this.root || parent.nodeType == /* DOCUMENT */ 9) {\n      atRoot = true;\n      if (parent == this.root || parent == document) {\n        if (crossOriginUpdater && !this.root) {\n          if (!crossOriginRect ||\n              crossOriginRect.width == 0 && crossOriginRect.height == 0) {\n            // A 0-size cross-origin intersection means no-intersection.\n            parent = null;\n            parentRect = null;\n            intersectionRect = null;\n          } else {\n            parentRect = crossOriginRect;\n          }\n        } else {\n          parentRect = rootRect;\n        }\n      } else {\n        // Check if there's a frame that can be navigated to.\n        var frame = getParentNode(parent);\n        var frameRect = frame && getBoundingClientRect(frame);\n        var frameIntersect =\n            frame &&\n            this._computeTargetAndRootIntersection(frame, frameRect, rootRect);\n        if (frameRect && frameIntersect) {\n          parent = frame;\n          parentRect = convertFromParentRect(frameRect, frameIntersect);\n        } else {\n          parent = null;\n          intersectionRect = null;\n        }\n      }\n    } else {\n      // If the element has a non-visible overflow, and it's not the <body>\n      // or <html> element, update the intersection rect.\n      // Note: <body> and <html> cannot be clipped to a rect that's not also\n      // the document rect, so no need to compute a new intersection.\n      var doc = parent.ownerDocument;\n      if (parent != doc.body &&\n          parent != doc.documentElement &&\n          parentComputedStyle.overflow != 'visible') {\n        parentRect = getBoundingClientRect(parent);\n      }\n    }\n\n    // If either of the above conditionals set a new parentRect,\n    // calculate new intersection data.\n    if (parentRect) {\n      intersectionRect = computeRectIntersection(parentRect, intersectionRect);\n    }\n    if (!intersectionRect) break;\n    parent = parent && getParentNode(parent);\n  }\n  return intersectionRect;\n};\n\n\n/**\n * Returns the root rect after being expanded by the rootMargin value.\n * @return {ClientRect} The expanded root rect.\n * @private\n */\nIntersectionObserver.prototype._getRootRect = function() {\n  var rootRect;\n  if (this.root) {\n    rootRect = getBoundingClientRect(this.root);\n  } else {\n    // Use <html>/<body> instead of window since scroll bars affect size.\n    var html = document.documentElement;\n    var body = document.body;\n    rootRect = {\n      top: 0,\n      left: 0,\n      right: html.clientWidth || body.clientWidth,\n      width: html.clientWidth || body.clientWidth,\n      bottom: html.clientHeight || body.clientHeight,\n      height: html.clientHeight || body.clientHeight\n    };\n  }\n  return this._expandRectByRootMargin(rootRect);\n};\n\n\n/**\n * Accepts a rect and expands it by the rootMargin value.\n * @param {DOMRect|ClientRect} rect The rect object to expand.\n * @return {ClientRect} The expanded rect.\n * @private\n */\nIntersectionObserver.prototype._expandRectByRootMargin = function(rect) {\n  var margins = this._rootMarginValues.map(function(margin, i) {\n    return margin.unit == 'px' ? margin.value :\n        margin.value * (i % 2 ? rect.width : rect.height) / 100;\n  });\n  var newRect = {\n    top: rect.top - margins[0],\n    right: rect.right + margins[1],\n    bottom: rect.bottom + margins[2],\n    left: rect.left - margins[3]\n  };\n  newRect.width = newRect.right - newRect.left;\n  newRect.height = newRect.bottom - newRect.top;\n\n  return newRect;\n};\n\n\n/**\n * Accepts an old and new entry and returns true if at least one of the\n * threshold values has been crossed.\n * @param {?IntersectionObserverEntry} oldEntry The previous entry for a\n *    particular target element or null if no previous entry exists.\n * @param {IntersectionObserverEntry} newEntry The current entry for a\n *    particular target element.\n * @return {boolean} Returns true if a any threshold has been crossed.\n * @private\n */\nIntersectionObserver.prototype._hasCrossedThreshold =\n    function(oldEntry, newEntry) {\n\n  // To make comparing easier, an entry that has a ratio of 0\n  // but does not actually intersect is given a value of -1\n  var oldRatio = oldEntry && oldEntry.isIntersecting ?\n      oldEntry.intersectionRatio || 0 : -1;\n  var newRatio = newEntry.isIntersecting ?\n      newEntry.intersectionRatio || 0 : -1;\n\n  // Ignore unchanged ratios\n  if (oldRatio === newRatio) return;\n\n  for (var i = 0; i < this.thresholds.length; i++) {\n    var threshold = this.thresholds[i];\n\n    // Return true if an entry matches a threshold or if the new ratio\n    // and the old ratio are on the opposite sides of a threshold.\n    if (threshold == oldRatio || threshold == newRatio ||\n        threshold < oldRatio !== threshold < newRatio) {\n      return true;\n    }\n  }\n};\n\n\n/**\n * Returns whether or not the root element is an element and is in the DOM.\n * @return {boolean} True if the root element is an element and is in the DOM.\n * @private\n */\nIntersectionObserver.prototype._rootIsInDom = function() {\n  return !this.root || containsDeep(document, this.root);\n};\n\n\n/**\n * Returns whether or not the target element is a child of root.\n * @param {Element} target The target element to check.\n * @return {boolean} True if the target element is a child of root.\n * @private\n */\nIntersectionObserver.prototype._rootContainsTarget = function(target) {\n  return containsDeep(this.root || document, target) &&\n    (!this.root || this.root.ownerDocument == target.ownerDocument);\n};\n\n\n/**\n * Adds the instance to the global IntersectionObserver registry if it isn't\n * already present.\n * @private\n */\nIntersectionObserver.prototype._registerInstance = function() {\n  if (registry.indexOf(this) < 0) {\n    registry.push(this);\n  }\n};\n\n\n/**\n * Removes the instance from the global IntersectionObserver registry.\n * @private\n */\nIntersectionObserver.prototype._unregisterInstance = function() {\n  var index = registry.indexOf(this);\n  if (index != -1) registry.splice(index, 1);\n};\n\n\n/**\n * Returns the result of the performance.now() method or null in browsers\n * that don't support the API.\n * @return {number} The elapsed time since the page was requested.\n */\nfunction now() {\n  return window.performance && performance.now && performance.now();\n}\n\n\n/**\n * Throttles a function and delays its execution, so it's only called at most\n * once within a given time period.\n * @param {Function} fn The function to throttle.\n * @param {number} timeout The amount of time that must pass before the\n *     function can be called again.\n * @return {Function} The throttled function.\n */\nfunction throttle(fn, timeout) {\n  var timer = null;\n  return function () {\n    if (!timer) {\n      timer = setTimeout(function() {\n        fn();\n        timer = null;\n      }, timeout);\n    }\n  };\n}\n\n\n/**\n * Adds an event handler to a DOM node ensuring cross-browser compatibility.\n * @param {Node} node The DOM node to add the event handler to.\n * @param {string} event The event name.\n * @param {Function} fn The event handler to add.\n * @param {boolean} opt_useCapture Optionally adds the even to the capture\n *     phase. Note: this only works in modern browsers.\n */\nfunction addEvent(node, event, fn, opt_useCapture) {\n  if (typeof node.addEventListener == 'function') {\n    node.addEventListener(event, fn, opt_useCapture || false);\n  }\n  else if (typeof node.attachEvent == 'function') {\n    node.attachEvent('on' + event, fn);\n  }\n}\n\n\n/**\n * Removes a previously added event handler from a DOM node.\n * @param {Node} node The DOM node to remove the event handler from.\n * @param {string} event The event name.\n * @param {Function} fn The event handler to remove.\n * @param {boolean} opt_useCapture If the event handler was added with this\n *     flag set to true, it should be set to true here in order to remove it.\n */\nfunction removeEvent(node, event, fn, opt_useCapture) {\n  if (typeof node.removeEventListener == 'function') {\n    node.removeEventListener(event, fn, opt_useCapture || false);\n  }\n  else if (typeof node.detatchEvent == 'function') {\n    node.detatchEvent('on' + event, fn);\n  }\n}\n\n\n/**\n * Returns the intersection between two rect objects.\n * @param {Object} rect1 The first rect.\n * @param {Object} rect2 The second rect.\n * @return {?Object|?ClientRect} The intersection rect or undefined if no\n *     intersection is found.\n */\nfunction computeRectIntersection(rect1, rect2) {\n  var top = Math.max(rect1.top, rect2.top);\n  var bottom = Math.min(rect1.bottom, rect2.bottom);\n  var left = Math.max(rect1.left, rect2.left);\n  var right = Math.min(rect1.right, rect2.right);\n  var width = right - left;\n  var height = bottom - top;\n\n  return (width >= 0 && height >= 0) && {\n    top: top,\n    bottom: bottom,\n    left: left,\n    right: right,\n    width: width,\n    height: height\n  } || null;\n}\n\n\n/**\n * Shims the native getBoundingClientRect for compatibility with older IE.\n * @param {Element} el The element whose bounding rect to get.\n * @return {DOMRect|ClientRect} The (possibly shimmed) rect of the element.\n */\nfunction getBoundingClientRect(el) {\n  var rect;\n\n  try {\n    rect = el.getBoundingClientRect();\n  } catch (err) {\n    // Ignore Windows 7 IE11 \"Unspecified error\"\n    // https://github.com/w3c/IntersectionObserver/pull/205\n  }\n\n  if (!rect) return getEmptyRect();\n\n  // Older IE\n  if (!(rect.width && rect.height)) {\n    rect = {\n      top: rect.top,\n      right: rect.right,\n      bottom: rect.bottom,\n      left: rect.left,\n      width: rect.right - rect.left,\n      height: rect.bottom - rect.top\n    };\n  }\n  return rect;\n}\n\n\n/**\n * Returns an empty rect object. An empty rect is returned when an element\n * is not in the DOM.\n * @return {ClientRect} The empty rect.\n */\nfunction getEmptyRect() {\n  return {\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    width: 0,\n    height: 0\n  };\n}\n\n\n/**\n * Ensure that the result has all of the necessary fields of the DOMRect.\n * Specifically this ensures that `x` and `y` fields are set.\n *\n * @param {?DOMRect|?ClientRect} rect\n * @return {?DOMRect}\n */\nfunction ensureDOMRect(rect) {\n  // A `DOMRect` object has `x` and `y` fields.\n  if (!rect || 'x' in rect) {\n    return rect;\n  }\n  // A IE's `ClientRect` type does not have `x` and `y`. The same is the case\n  // for internally calculated Rect objects. For the purposes of\n  // `IntersectionObserver`, it's sufficient to simply mirror `left` and `top`\n  // for these fields.\n  return {\n    top: rect.top,\n    y: rect.top,\n    bottom: rect.bottom,\n    left: rect.left,\n    x: rect.left,\n    right: rect.right,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\n\n/**\n * Inverts the intersection and bounding rect from the parent (frame) BCR to\n * the local BCR space.\n * @param {DOMRect|ClientRect} parentBoundingRect The parent's bound client rect.\n * @param {DOMRect|ClientRect} parentIntersectionRect The parent's own intersection rect.\n * @return {ClientRect} The local root bounding rect for the parent's children.\n */\nfunction convertFromParentRect(parentBoundingRect, parentIntersectionRect) {\n  var top = parentIntersectionRect.top - parentBoundingRect.top;\n  var left = parentIntersectionRect.left - parentBoundingRect.left;\n  return {\n    top: top,\n    left: left,\n    height: parentIntersectionRect.height,\n    width: parentIntersectionRect.width,\n    bottom: top + parentIntersectionRect.height,\n    right: left + parentIntersectionRect.width\n  };\n}\n\n\n/**\n * Checks to see if a parent element contains a child element (including inside\n * shadow DOM).\n * @param {Node} parent The parent element.\n * @param {Node} child The child element.\n * @return {boolean} True if the parent node contains the child node.\n */\nfunction containsDeep(parent, child) {\n  var node = child;\n  while (node) {\n    if (node == parent) return true;\n\n    node = getParentNode(node);\n  }\n  return false;\n}\n\n\n/**\n * Gets the parent node of an element or its host element if the parent node\n * is a shadow root.\n * @param {Node} node The node whose parent to get.\n * @return {Node|null} The parent node or null if no parent exists.\n */\nfunction getParentNode(node) {\n  var parent = node.parentNode;\n\n  if (node.nodeType == /* DOCUMENT */ 9 && node != document) {\n    // If this node is a document node, look for the embedding frame.\n    return getFrameElement(node);\n  }\n\n  if (parent && parent.nodeType == 11 && parent.host) {\n    // If the parent is a shadow root, return the host element.\n    return parent.host;\n  }\n\n  if (parent && parent.assignedSlot) {\n    // If the parent is distributed in a <slot>, return the parent of a slot.\n    return parent.assignedSlot.parentNode;\n  }\n\n  return parent;\n}\n\n\n/**\n * Returns the embedding frame element, if any.\n * @param {!Document} doc\n * @return {!Element}\n */\nfunction getFrameElement(doc) {\n  try {\n    return doc.defaultView && doc.defaultView.frameElement || null;\n  } catch (e) {\n    // Ignore the error.\n    return null;\n  }\n}\n\n\n// Exposes the constructors globally.\nwindow.IntersectionObserver = IntersectionObserver;\nwindow.IntersectionObserverEntry = IntersectionObserverEntry;\n\n}());\n","import { RefObject } from 'react';\nimport { ElementMap, Threshold } from './types';\nimport { __CLIENT__ } from './utils/constants';\nimport 'intersection-observer';\n\nclass SectionObserver {\n  public elementMap: ElementMap;\n\n  private observer: IntersectionObserver | undefined;\n\n  private debounceExecute = 0;\n\n  constructor(debounce: boolean, threshold: Threshold) {\n    this.elementMap = new Map();\n    try {\n      this.observer = new window.IntersectionObserver(\n        entries => {\n          if (debounce) {\n            this.debounceSectionIntersect(entries);\n          } else {\n            this.sectionIntersect(entries);\n          }\n        },\n        {\n          threshold: [threshold],\n        },\n      );\n    } catch (error) {\n      console.log(`Error occur when creating IntersectionObserver: ${error}`);\n    }\n  }\n\n  sectionObserve = (ref: RefObject<any>, callback: Function) => {\n    this.observer?.observe(ref.current);\n    this.elementMap.set(ref.current, callback);\n  };\n\n  sectionUnobserve = (ref: RefObject<any>) => {\n    this.observer?.unobserve(ref.current);\n    if (this.elementMap.has(ref.current)) this.elementMap.delete(ref.current);\n  };\n\n  resetSectionObserver = () => {\n    this.elementMap.forEach((value, key) => {\n      this.observer?.observe(key);\n    });\n  };\n\n  private sectionIntersect = (entries: IntersectionObserverEntry[]) => {\n    entries.forEach(entry => {\n      const { target } = entry;\n      if (entry.isIntersecting && this.elementMap.has(target)) {\n        const callback = this.elementMap.get(target);\n        if (!callback) return;\n\n        callback();\n\n        this.observer?.unobserve(target);\n      }\n    });\n  };\n\n  private debounceSectionIntersect = (entries: IntersectionObserverEntry[]) => {\n    entries.forEach(entry => {\n      const { target } = entry;\n      if (entry.isIntersecting && this.elementMap.has(target)) {\n        const callback = this.elementMap.get(target);\n        if (!callback) return;\n\n        clearTimeout(this.debounceExecute);\n        this.debounceExecute = window.setTimeout(() => {\n          callback();\n        }, 1000);\n\n        this.observer?.unobserve(target);\n      }\n    });\n  };\n}\n\nexport let completeSectionObserver: SectionObserver | undefined;\nexport let halfSectionObserver: SectionObserver | undefined;\nexport let minSectionObserver: SectionObserver | undefined;\nexport let rankSectionObserver: SectionObserver | undefined;\n\nexport function registCompleteSectionObserver(ref: RefObject<any>, callback: Function) {\n  if (!__CLIENT__) {\n    throw new Error('[registCompleteSectionObserver()] should be invoked on client side.');\n  }\n  if (!completeSectionObserver) completeSectionObserver = new SectionObserver(false, Threshold.FULL);\n  completeSectionObserver.sectionObserve(ref, callback);\n  return () => {\n    completeSectionObserver!.sectionUnobserve(ref);\n  };\n}\n\nexport function registHalfSectionObserver(ref: RefObject<any>, callback: Function) {\n  if (!__CLIENT__) {\n    throw new Error('[registHalfSectionObserver()] should be invoked on client side.');\n  }\n\n  if (!halfSectionObserver) halfSectionObserver = new SectionObserver(false, Threshold.HALF);\n  halfSectionObserver.sectionObserve(ref, callback);\n  return () => {\n    halfSectionObserver!.sectionUnobserve(ref);\n  };\n}\n\nexport function registMinSectionObserver(ref: RefObject<any>, callback: Function) {\n  if (!__CLIENT__) {\n    throw new Error('[registMinSectionObserver()] should be invoked on client side.');\n  }\n\n  if (!minSectionObserver) minSectionObserver = new SectionObserver(false, Threshold.MIN);\n  minSectionObserver.sectionObserve(ref, callback);\n  return () => {\n    minSectionObserver!.sectionUnobserve(ref);\n  };\n}\n\nexport function registRankSectionObserver(ref: RefObject<any>, callback: Function) {\n  if (!__CLIENT__) {\n    throw new Error('[registRankSectionObserver()] should be invoked on client side.');\n  }\n\n  if (!rankSectionObserver) rankSectionObserver = new SectionObserver(true, Threshold.FULL);\n  rankSectionObserver.sectionObserve(ref, callback);\n  return () => {\n    rankSectionObserver!.sectionUnobserve(ref);\n  };\n}\n\nexport function resetSectionObserverStatus() {\n  if (completeSectionObserver) completeSectionObserver.resetSectionObserver();\n  if (halfSectionObserver) halfSectionObserver.resetSectionObserver();\n  if (minSectionObserver) minSectionObserver.resetSectionObserver();\n  if (rankSectionObserver) rankSectionObserver.resetSectionObserver();\n}\n","import { RefObject, useEffect } from 'react';\nimport { History } from 'history';\nimport { DefaultSource } from './Source';\n\nimport {\n  registCompleteSectionObserver,\n  registHalfSectionObserver,\n  registMinSectionObserver,\n  registRankSectionObserver,\n  resetSectionObserverStatus,\n} from './Observer';\n\nexport function useCompleteSectionTracking(ref: RefObject<any>, callback: Function) {\n  useEffect(() => {\n    if (ref.current === null) return;\n    return registCompleteSectionObserver(ref, callback);\n  });\n}\n\nexport function useHalfSectionTracking(ref: RefObject<any>, callback: Function) {\n  useEffect(() => {\n    if (ref.current === null) return;\n    return registHalfSectionObserver(ref, callback);\n  });\n}\n\nexport function useMinSectionTracking(ref: RefObject<any>, callback: Function) {\n  useEffect(() => {\n    if (ref.current === null) return;\n    return registMinSectionObserver(ref, callback);\n  });\n}\n\nexport function useRankSectionTracking(ref: RefObject<any>, callback: Function) {\n  useEffect(() => {\n    if (ref.current === null) return;\n    return registRankSectionObserver(ref, callback);\n  });\n}\n\nexport function usePageTransitionListener(trackingSource: DefaultSource, history: History) {\n  useEffect(() => {\n    // Regist history (for page_view & screen_view)\n    trackingSource.spyTransition(history);\n    history.listen(() => {\n      resetSectionObserverStatus();\n    });\n  }, [history]);\n}\n","import {\n  EVENT_NAME_CLICK,\n  EVENT_NAME_ENTER,\n  EVENT_NAME_LEAVE,\n  EVENT_NAME_SEARCH,\n  EVENT_NAME_SECTION_VIEW,\n  CATEGORY_DEFAULT,\n  ACTION_BUTTON_CLICK,\n  ACTION_TAB_CLICK,\n  ACTION_PROFILE_CLICK,\n  ACTION_LINK_CLICK,\n  ACTION_ENTER,\n} from './utils/constants';\n\nimport { TrackingEvent } from './types';\n\ntype EventAction = Omit<TrackingEvent, 'type'>;\ntype SectionName = 'buttons' | 'duration' | 'gifts' | 'searchBar' | 'tabs' | 'description' | 'timeline' | 'topStreamer';\ntype ProfileName = 'topavatar' | 'avatar';\n\nexport function createButtonClickAction(buttonName: string, link: string): EventAction {\n  return {\n    eventName: EVENT_NAME_CLICK,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_BUTTON_CLICK,\n      name: buttonName,\n      page: link,\n    },\n  };\n}\n\nexport function createPageEnterAction(\n  utmCampaign: string,\n  utmContent: string,\n  utmMedium: string,\n  utmSource: string,\n): EventAction {\n  return {\n    eventName: EVENT_NAME_ENTER,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      utmCampaign,\n      utmContent,\n      utmMedium,\n      utmSource,\n    },\n  };\n}\n\nexport function createPageLeaveAction(): EventAction {\n  return {\n    eventName: EVENT_NAME_LEAVE,\n    category: CATEGORY_DEFAULT,\n  };\n}\n\nexport function createTabClickAction(link: string, tabName: string): EventAction {\n  return {\n    eventName: EVENT_NAME_CLICK,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_TAB_CLICK,\n      page: link,\n      name: tabName,\n    },\n  };\n}\n\nexport function createProfileClickAction(userID: string, liveStatus: boolean, profileType: ProfileName): EventAction {\n  return {\n    eventName: EVENT_NAME_CLICK,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_PROFILE_CLICK,\n      type: profileType,\n      streamerId: userID,\n      liveStatus: liveStatus,\n      leaderboardId: '',\n      hasDeeplink: false,\n    },\n  };\n}\n\nexport function createSearchAction(keyword: string, count: number): EventAction {\n  return {\n    eventName: EVENT_NAME_SEARCH,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      searchString: keyword,\n      resultCount: count,\n    },\n  };\n}\n\nexport function createVoteAction(voteTopic: string): EventAction {\n  return {\n    eventName: EVENT_NAME_CLICK,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_BUTTON_CLICK,\n      name: voteTopic,\n      type: 'vote',\n    },\n  };\n}\n\nexport function createLeaderboardSectionViewAction(rank: number): EventAction {\n  return {\n    eventName: EVENT_NAME_SECTION_VIEW,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_ENTER,\n      section: 'leaderboardItem',\n      rank,\n    },\n  };\n}\n\nexport function createLinkClickAction(link: string, linkName: string): EventAction {\n  return {\n    eventName: EVENT_NAME_CLICK,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_LINK_CLICK,\n      url: link,\n      name: linkName,\n    },\n  };\n}\n\nexport function createSectionViewAction(section: SectionName, customPath?: string): EventAction {\n  return {\n    eventName: EVENT_NAME_SECTION_VIEW,\n    category: CATEGORY_DEFAULT,\n    trackingParams: {\n      action: ACTION_ENTER,\n      section,\n      // For customized event to use.\n      customPath,\n    },\n  };\n}\n"],"names":["object.convertParamsToSankecase","object.trim","rnds8","Uint8Array","rng","crypto","randomFillSync","byteToHex","i","push","toString","substr","bytesToUuid","buf","offset_","offset","toLowerCase","v4","options","rnds","random","dom.getContent","dom.guessRole","window","IntersectionObserverEntry","prototype","Object","defineProperty","get","intersectionRatio","document","registry","crossOriginUpdater","crossOriginRect","entry","time","target","rootBounds","ensureDOMRect","boundingClientRect","intersectionRect","getEmptyRect","isIntersecting","targetRect","targetArea","width","height","intersectionArea","Number","toFixed","IntersectionObserver","callback","opt_options","Error","root","nodeType","_checkForIntersections","throttle","bind","THROTTLE_TIMEOUT","_callback","_observationTargets","_queuedEntries","_rootMarginValues","_parseRootMargin","rootMargin","thresholds","_initThresholds","threshold","map","margin","value","unit","join","_monitoringDocuments","_monitoringUnsubscribes","POLL_INTERVAL","USE_MUTATION_OBSERVER","_setupCrossOriginUpdater","convertFromParentRect","forEach","observer","_resetCrossOriginUpdater","observe","isTargetAlreadyObserved","some","item","element","_registerInstance","_monitorIntersections","ownerDocument","unobserve","filter","_unmonitorIntersections","length","_unregisterInstance","disconnect","_unmonitorAllIntersections","takeRecords","records","slice","opt_threshold","Array","isArray","sort","t","a","isNaN","opt_rootMargin","marginString","margins","split","parts","exec","parseFloat","doc","win","defaultView","indexOf","monitoringInterval","domObserver","setInterval","addEvent","MutationObserver","attributes","childList","characterData","subtree","clearInterval","removeEvent","frame","getFrameElement","index","rootDoc","hasDependentTargets","itemDoc","unsubscribe","splice","unsubscribes","rootIsInDom","_rootIsInDom","rootRect","_getRootRect","getBoundingClientRect","rootContainsTarget","_rootContainsTarget","oldEntry","_computeTargetAndRootIntersection","newEntry","now","_hasCrossedThreshold","getComputedStyle","display","parent","getParentNode","atRoot","parentRect","parentComputedStyle","frameRect","frameIntersect","body","documentElement","overflow","computeRectIntersection","html","top","left","right","clientWidth","bottom","clientHeight","_expandRectByRootMargin","rect","newRect","oldRatio","newRatio","containsDeep","performance","fn","timeout","timer","setTimeout","node","event","opt_useCapture","addEventListener","attachEvent","removeEventListener","detatchEvent","rect1","rect2","Math","max","min","el","err","y","x","parentBoundingRect","parentIntersectionRect","child","parentNode","host","assignedSlot","frameElement","e"],"mappings":"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"}